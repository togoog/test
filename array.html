<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<style>
			body {
				font-family: sans-serif;
				font-size: 0.9em;
			}

			table {
				border-collapse: collapse;
				border-bottom: 1px solid #ddd;
			}

			thead {
				background-color: #333;
				color: #fff;
			}

			thead,
			tbody {
				display: block;
			}

			th,
			td {
				padding: 8px 10px;
				border: 1px solid #ddd;
				width: 117px;
				box-sizing: border-box;
			}

			tbody {
				height: 160px;
				overflow-y: scroll
			}
		</style>
		<script>
			
			var tarr = ["a:1","a:1_2","a:1_2_3","a:1_2_3_4","a:1_2_3_5","a:1_10_11_12","a:1_10_11_13","a:1_10","a:1_10_11","a:1_2_6","a:1_2_7"];
			//tarr = tarr.sort();
			tarr.forEach(function(item,i){
				var treenodestr = item.split(":")[1];
				var treenodearr = treenodestr.split("_");
				treenodearr.forEach(function(node){
					//console.log(node);
				})
			})
			
			//一.升序排列
			var theArray1 = [2, 3, 5, 1, 15, 8, 12, 11, 7];
			//console.log("aaa:" + theArray1.sort());

			var theArray1 = ["2017-03-11", "2017-02-8", "2017-03-08", "2017-04-12", "2017-03-18"];
			//console.log("aaa:" + theArray1.sort()[0]);
			/*function des1(a, b) {
				return a - b;
			}
			console.log(theArray1.sort(des1));

			//二.降序排列
			var theArray = [2, 3, 5, 1, 15, 8, 12, 11, 7];

			function des(a, b) {
				return b - a;
			}
			console.log(theArray.sort(des));*/

			var arrA = [6, 2, 4, 3, 5, 1];
			/*arrA.sort();
			document.writeln(arrA);
			*/
			function desc(x, y) {
				if (x > y)
					return -1;
				if (x < y)
					return 1;
			}

			function asc(x, y) {
				if (x > y)
					return 1;
				if (x < y)
					return -1;
			}

			arrA.sort(desc); // sort by desc
			document.writeln(arrA);
			document.writeln("<br>");
			arrA.sort(asc); //sort by asc
			document.writeln(arrA);

			//输出结果：
			//6,5,4,3,2,1 
			//1,2,3,4,5,6 
			//另外，可以直接把一个无名函数直接放到sort()方法的调用中。如下的例子是将奇数排在前面，偶数排在后面，例子如下：

			var arrA = [6, 2, 4, 3, 5, 1];
			arrA.sort(function(x, y) {
				if (x % 2 == 0)
					return 11;
				if (x % 2 != 0)
					return -1;
			});
			document.writeln(arrA);

			var a = {
				"测试01": ["01", "02", "03"],
				"测试02": ["04", "05"]
			}

			var ta = null;
			//ta = [{name:"测试01",value:"01"},{name:"测试01",value:"02"},{name:"测试01",value:"03"},{name:"测试02",value:"04"},{name:"测试02",value:"05"}];
			ta = [{
				name: "测试02",
				value: "04"
			}, {
				name: "测试02",
				value: "05"
			}, {
				name: "测试01",
				value: "01"
			}, {
				name: "测试01",
				value: "02"
			}, {
				name: "测试01",
				value: "03"
			}];
			var tt = ["测试01", "测试02"]

			var ss = "测试01:01;测试02:04;测试03:21";
			//ss = ""
			var ks = ss.split(";");
			tt = [];
			for (var i = 0, l = ks.length; i < l; i++) {
				var nn = ks[i].split(":");
				tt.push(nn[0]);
			}
			//console.log(tt.toString());
			var nna = [];
			for (var j = 0, leng = tt.length; j < leng; j++) {
				for (var i = 0, len = ta.length; i < len; i++) {
					if (tt[j] == ta[i]['name']) {
						var id = ta[i]['name'];
						var val = ta[i]['value'];
						//console.log("id:" + id + "-- val:" + val)
						//nna[id].push(val)
						//nna[id].push(val)
					}
				}
			}

			//console.log(nna)
			//			for(var obj in nna){
			//				console.log(nna[obj]);
			//				var aa = a[obj];
			//				for(var i= 0,len = aa.length;i<len;i++){
			//					console.log(obj+":"+aa[i])
			//				}
			//			}
			//输出：1,5,3,4,6,2

			var textArr = [
				['a', 'b', 'c'],
				['d', 'e', 'f', 'g'],
				['h', 'i']
			];

			var k1 = {
				'k1': ['a', 'b']
			};
			console.log(k1);
			textArr = [
				['a', 'b'],
				['1', '2'],
				['c'],
				['d'],
				['e']
			]
			//			a,1,c,d,e
			//			a,2,c,d,e
			//			b,1,c,d,e
			//			b,2,c,d,e
			//			var getCombination = function(arr) {
			//				var resultArry = [];
			//				arr.forEach(function(arrItem) {
			//					if (resultArry.length === 0) {
			//						resultArry = arrItem;
			//					} else {
			//						var emptyArray = [];
			//						resultArry.forEach(function(item) {
			//							arrItem.forEach(function(value) {
			//								emptyArray.push([...item, value]);//ie不支持
			//								//emptyArray.push(item.push(value));
			//								//emptyArray.push(item.concat(value));
			//							})
			//						})
			//						resultArry = emptyArray;
			//					}
			//				});
			//				return resultArry;
			//			}
			//			console.log(getCombination(textArr));


			function concatArr(arr) {
				var sarr = [
					[]
				];
				var result = [];
				arr.forEach(function(value, i) {
					var tarr = [];
					sarr.forEach(function(value, j) {
						arr[i].forEach(function(value, k) {
							tarr.push(sarr[j].concat(arr[i][k]));
						});
					});
					sarr = tarr;
				});
				sarr.forEach(function(value, i) {
					result.push(sarr[i]);
				})

				return result;
			}

			//console.log(concatArr(textArr));

			var arr1 = ['a', 'b'];
			var arr2 = ['a', 'c', 'd'];
			var arr3 = [1, 'd', undefined, true, null];

			//合并两个数组，去重  
			var concat_ = function(arr1, arr2) {
				//不要直接使用var arr = arr1，这样arr只是arr1的一个引用，两者的修改会互相影响  
				var arr = arr1.concat();
				//或者使用slice()复制，var arr = arr1.slice(0)  
				for (var i = 0; i < arr2.length; i++) {
					arr.indexOf(arr2[i]) === -1 ? arr.push(arr2[i]) : 0; //indexOf ie8 <=以下不支持
				}
				return arr;
			}

			//合并多个数组，去重  
			var concat = function(arr1, arr2, arr3) {
				if (arguments.length <= 1) {
					return false;
				}
				var concat_ = function(arr1, arr2) {
					var arr = arr1.concat();
					for (var i = 0; i < arr2.length; i++) {
						arr.indexOf(arr2[i]) === -1 ? arr.push(arr2[i]) : 0; //indexOf ie8 <=以下不支持
					}
					return arr;
				}
				var result = concat_(arr1, arr2);
				for (var i = 2; i < arguments.length; i++) {
					result = concat_(result, arguments[i]);
				}
				return result;
			}

			//合并多个数组，去重，排序  
			var arr1 = [1, 6, 4, 0];
			var arr2 = [8, 20, 7, 4.5];
			var arr3 = [6, 0, 7, 90, 2];

			var concat = function(arr1, arr2, arr3) {
				if (arguments.length <= 1) {
					return false;
				}
				var concat_ = function(arr1, arr2) {
					var arr = arr1.concat();
					for (var i = 0; i < arr2.length; i++) {
						arr.indexOf(arr2[i]) === -1 ? arr.push(arr2[i]) : 0; //indexOf ie8 <=以下不支持
					}
					return arr;
				}
				var result = concat_(arr1, arr2);
				for (var i = 2; i < arguments.length; i++) {
					result = concat_(result, arguments[i]);
				}
				//排序  
				function sortNumber(a, b) {
					return a - b;
				}
				return result.sort(sortNumber);
			}
			//console.log(concat(arr1, arr2, arr3));

			function combination(arr) {
				var sarr = [
					[]
				];
				var result = [];
				for (var i = 0; i < arr.length; i++) {
					var tarr = [];
					for (var j = 0; j < sarr.length; j++) {
						for (var k = 0; k < arr[i].length; k++) {
							tarr.push(sarr[j].concat(arr[i][k]));
						}
					}
					sarr = tarr;
				}
				for (var m = 0; m < sarr.length; m++) {
					//result.push(sarr[m].join('.')); 
					result.push(sarr[m]);
				}
				return result;
			}
			var garr = [
				["a", "b"],
				["1", "2"],
				["c", "d"]
			];
			garr = [
				['a', 'b'],
				['1', '2'],
				['c'],
				['d'],
				['e']
			]
			var result = combination(garr);
			//console.log(result);

			var left = [{
					name: 'A',
					lid: 22
				},
				{
					name: 'B',
					lid: 32
				},
				{
					name: 'C',
					lid: 15
				},
				{
					name: 'D',
					lid: 26
				},
				{
					name: 'E',
					lid: 57
				}
			];
			var right = [{
					value: '百度',
					rid: 14
				},
				{
					value: '京东',
					rid: 23
				},
				{
					value: '阿里',
					rid: 15
				},
				{
					value: '腾讯',
					rid: 44
				},
				{
					value: '新浪',
					rid: 57
				},
				{
					value: '果壳',
					rid: 88
				},
				{
					value: '小米',
					rid: 22
				},
				{
					value: '高德',
					rid: 40
				},
				{
					value: '华为',
					rid: 32
				},
				{
					value: '北斗',
					rid: 64
				},
				{
					value: '谷歌',
					rid: 26
				}
			];
			var middle = [];
			//console.log(buildingArr(left, right, middle));
			/**
			 * 关联性数组
			 * @param arrLeft 一级数据集
			 * @param arrRight 二级数据集
			 * @param tempArr 临时数组
			 **/
			function buildingArr(arrLeft, arrRight, tempArr) {
				tempArr = arrLeft.map(function(item) { ////map ie8 <=以下不支持
					var temp = item;
					item["value"] = buildingArrTwo({
						leftId: item["lid"],
						rightArr: arrRight
					})["value"];
					return temp;
				});
				return tempArr;
			}

			/**
			 * 合并数组
			 * @param obj 数据信息
			 **/
			function buildingArrTwo(obj) {
				//获取父级id
				var leftId = obj["leftId"];
				//获取子级数组
				var rightArr = obj["rightArr"];
				for (var i = 0, j = rightArr.length; i < j; i++) {
					if (rightArr[i]["rid"] === leftId) {
						return rightArr[i];
					}
				}
			}
		</script>
	</head>

	<body>
		<button id="btn">添加</button>
		<div id="datadiv">

		</div>
		<div id="tablediv">
		</div>
		<label class="lab">test</label>
	</body>
	<script src="js/common/jquery-1.12.4.js"></script>
	<!-- <script src="js/jquery.min.js"></script> -->
	<script>
		$(function() {
			$("#btn").off("click").on("click", function() {
				var htmstr =
					'<div><div class="attr"><input class="attrname" type="text" placeholder="name">:<div class="attrvalue" style="display:inline-block;"><input class="selectval" type="checkbox"><input class="attrval" type="text" placeholder="value"> <span class="dellab">删除</span> </div></div><span class="addlab">最多添加10项</span></div>';
				$("#datadiv").append(htmstr);
				// $("#selectval").off("change").on("change", function() {
				// 	console.log($(this).prop("checked"))
				// })
			})

			function myTrim(value) {
				return value.replace(/^\s+|\s+$/gm, '');
			}

			function myFunction() {
				var str = myTrim("        Runoob        ");
				alert(str);
			}

			$("#datadiv").on("change", ".selectval", function() {
				//alert($(this).text());
				var target = $(this);
				//console.log(target.prop("checked"));
				var attrname = target.parent().parent().find(".attrname");
				var attrval = target.next();
				if (myTrim(attrname.val()) == "" || attrname.val().length == 0) {
					alert("属性名不能为空");
					attrname.val("");
					target.prop("checked", false);
					return;
				}

				if (myTrim(attrval.val()) == "" || attrval.val().length == 0) {
					alert("属性值不能为空");
					attrval.val("");
					target.prop("checked", false);
					return;
				}

				var atval = attrval.val();
				var atname = attrname.val();
				datachange();
			})


			$("#datadiv").on("click", ".addlab", function() {
				//alert($(this).text());
				var target = $(this);
				//console.log(target);
				var htmstr =
					'<div class="attrvalue" style="display:inline-block;"><input class="selectval" type="checkbox"><input class="attrval" type="text" placeholder="value"> <span class="dellab">删除</span> </div>';
				//console.log(target.parent().find(".attrvalue").length);
				if (target.parent().find(".attrvalue").length < 10) {
					target.parent().find(".attr").append(htmstr);
					//console.log(htmstr);
				}
			})

			$("#datadiv").on("click", ".dellab", function() {
				var target = $(this);
				if (target.parent().parent().find(".attrvalue").length == 1) {
					target.parent().parent().parent().remove();
				} else {
					target.parent().remove();
				}
				datachange();
			})

			function valcompare(target, cls) {
				//var cls = target.get

				if (cls == ".attrname") {
					var targetlist = $(cls).not($(target));
					if (targetlist.length > 0) {
						targetlist.each(function(i) {
							//console.log(targetlist[i].value);
							if (target.val() != "" && targetlist[i].value == target.val()) {
								alert("已存在相同值，请重新输入！");
								target.val("");
								return;
							}
						})
					}
				} else {
					var targetlist = $(target).parent().parent().find(cls).not($(target));
					if (targetlist.length > 0) {
						targetlist.each(function(i) {
							//console.log(targetlist[i].value);
							if (target.val() != "" && targetlist[i].value == target.val()) {
								alert("已存在相同值，请重新输入！");
								target.val("");
								return;
							}
						})
					}
				}
			}

			function datachange() {
				//console.log($(target));
				var dataarr = [];
				var namearr = [];
				var arrtnameList = $(".attrname");
				var namelen = arrtnameList.length;
				// var attrname = $("")
				for (var i = 0; i < namelen; i++) {
					var attrvalList = $(arrtnameList[i]).parent().find(".attrvalue");
					var attrname = $(arrtnameList[i]).val();
					var vallen = attrvalList.length;
					var valarr = [];
					for (var j = 0; j < vallen; j++) {
						var valcheck = $(attrvalList[j]).find(".selectval");
						var attrval = $(valcheck).parent().find(".attrval");
						//console.log($(valcheck).prop("checked"));
						if ($(valcheck).prop("checked") == true) {
							//console.log(attrval.val());
							valarr.push(attrval.val());
						}
					}
					if (valarr.length > 0) {
						dataarr.push(valarr);
						namearr.push(attrname);
					}

				}
				//console.log(dataarr);
				if (namearr.length > 0) {
					namearr.push("数量");
					namearr.push("价格");
					rendertable(namearr, createdata(dataarr));
				} else {
					$("#tablediv").children().remove();
				}
			}

			function createdata(arr) {
				var sarr = [
					[]
				];
				var result = [];
				for (var i = 0; i < arr.length; i++) {
					var tarr = [];
					for (var j = 0; j < sarr.length; j++) {
						for (var k = 0; k < arr[i].length; k++) {
							tarr.push(sarr[j].concat(arr[i][k]));
						}
					}
					sarr = tarr;
				}
				for (var m = 0; m < sarr.length; m++) {
					//result.push(sarr[m].join('.')); 
					result.push(sarr[m]);
				}
				return result;
			}

			$("#datadiv").on("change", ".attrname", function() {
				//alert($(this).text());
				var target = $(this);
				valchange(target);
				valcompare(target, ".attrname");
				//datachange();
			})

			$("#datadiv").on("change", ".attrval", function() {
				//alert($(this).text());
				var target = $(this);
				valchange(target);
				valcompare(target, ".attrval");
			})

			function valchange(target) {
				//var target = $(this);
				//console.log(target.val());

				target.val(myTrim(target.val()));

				if (target.val() == "" || target.val().length == 0) {
					//alert("属性值不能为空");
					if (target.hasClass(".attrval")) {
						target.next().val("");
						target.prev().prop("checked", false);
						//return;
					} else {
						target.val("");
						target.parent().find(".selectval").prop("checked", false);
					}
				}
				datachange();
			}

			var oldvallist = [
				[]
			];

			function rendertable(namearr, vallist) {
				var quantityarr = [];
				var pricearr = [];

				if ($(".quantity") != null && $(".quantity").length > 0) {
					var quantitylist = $(".quantity");
					var pricelist = $(".price");
					var quantitylen = quantitylist.length;
					for (var i = 0; i < quantitylen; i++) {
						quantityarr.push($(quantitylist[i]).val());
						pricearr.push($(pricelist[i]).val());
					}
					console.log(quantityarr);
				} else {
					quantityarr.push("");
					pricearr.push("");
				}

				if (quantityarr.length > 0 && quantityarr.length != vallist.length && oldvallist.length > 0) {
					if (oldvallist.length > vallist.length) {
						var olen = oldvallist.length;
						var vlen = vallist.length;
						var delarr = [];
						var newquantityarr = [];
						var newpricearr = [];
						for (var i = 0; i < vlen; i++) {
							for (var j = 0; j < olen; j++) {
								//console.log(oldvallist[j].join("")+"==="+ vallist[i].join(""));
								if (oldvallist[j].join("") == vallist[i].join("")) {
									//console.log(j);
									delarr.push(j);
								}
							}
						}
						var dellen = delarr.length;
						for (var k = 0; k < dellen; k++) {
							for (var l = 0; l < quantityarr.length; l++) {
								if (quantityarr[l] == quantityarr[delarr[k]]) {
									newquantityarr.push(quantityarr[l]);
									newpricearr.push(pricearr[l]);
								}
							}
						}
						
						if(dellen == 0){
							for (var n = 0; n < vallist.length; n++) {
								newquantityarr.push("");
								newpricearr.push("");
							}
						}

						quantityarr = newquantityarr;
						pricearr = newpricearr;
						//console.log("del:"+newquantityarr);
					} else {
						var olen = oldvallist.length;
						var vlen = vallist.length;
						var newadd = vlen - olen;

						var delarr = [];
						var newquantityarr = [];
						var newpricearr = [];
						var dellen = [];

						for (var i = 0; i < vlen; i++) {
							newquantityarr.push("");
							newpricearr.push("");
						}
						//console.log("add:"+quantityarr);
						// var ind = "";
						var indexarr = [];
						for (var i = 0; i < olen; i++) {
							for (var j = 0; j < vlen; j++) {
								//console.log(oldvallist[i].join("")+"==="+ vallist[j].join(""));
								if (oldvallist[i].join("") == vallist[j].join("")) {
									console.log(j);
									indexarr.push(j);
								}
							}
						}

						for (var k = 0; k < indexarr.length; k++) {
							newquantityarr.splice(indexarr[k], 1, quantityarr[k]);
							newpricearr.splice(indexarr[k], 1, pricearr[k]);
						}
						quantityarr = newquantityarr;
						pricearr = newpricearr;
					}
				}

				var htmstr = '<table class=""><thead><tr>';
				var namelen = namearr.length;
				for (var i = 0; i < namelen; i++) {
					htmstr += '<th>' + namearr[i] + '</th>';
				}
				htmstr += '</thead><tbody>';
				var len = vallist.length;
				for (var j = 0; j < len; j++) {
					htmstr += '<tr>';

					var childlen = vallist[j].length;
					for (var k = 0; k < childlen; k++) {
						if (vallist[j][k].length == 1) {
							htmstr += '<td>' + vallist[j] + '</td><td><input class="quantity" style="width: 100%;" type="text" value="' +
								quantityarr[0] + '"></td><td><input class="price" style="width: 100%;" type="text" value="' + pricearr[0] +
								'"></td>';
						} else {
							htmstr += '<td>' + vallist[j][k] + '</td>';
						}
					}
					htmstr += '<td><input class="quantity" style="width: 100%;" type="text" value="' + quantityarr[j] +
						'"></td><td><input class="price" style="width: 100%;" type="text" value="' + pricearr[j] + '"></td>';
					htmstr += '</tr>';
				}

				htmstr += '</tbody>';
				//console.log(htmstr);
				$("#tablediv").html(htmstr);
				oldvallist = clone(vallist);
				console.log(oldvallist);
			}

			function clone(obj) {
				var temp = null;
				if (obj instanceof Array) {
					temp = obj.concat();
				} else if (obj instanceof Function) {
					//函数是共享的是无所谓的，js也没有什么办法可以在定义后再修改函数内容
					temp = obj;
				} else {
					temp = new Object();
					for (var item in obj) {
						var val = obj[item];
						temp[item] = typeof val == 'object' ? clone(val) : val; //这里也没有判断是否为函数，因为对于函数，我们将它和一般值一样处理
					}
				}
				return temp;
			}

			$(".lab").off("click").on("click", function() {
				alert($(this).text());
			})

			$("#datadiv").on("input propertychange", "input", function() {
				//console.log($(this).val())
			});
		})
	</script>
</html>
