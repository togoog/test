<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title></title>
	</head>

	<body>
	</body>
	<script src="js/common/jquery-1.12.4.js"></script>
	<script>
		//js数组元素的添加和删除一直比较迷惑，今天终于找到详细说明的资料了，先给个我测试的代码^-^
		var arr = new Array();
		arr[0] = "aaa";
		arr[1] = "bbb";
		arr[2] = "ccc";
		//alert(arr.length);//3
		arr.pop();
		//alert(arr.length);//2
		//alert(arr[arr.length-1]);//bbb
		arr.pop();
		//alert(arr[arr.length-1]);//aaa
		//alert(arr.length);//1

		var arr2 = new Array();
		//alert(arr2.length);//0
		arr2[0] = "aaa";
		arr2[1] = "bbb";
		//alert(arr2.length);//2
		arr2.pop();
		//alert(arr2.length);//1
		arr2 = arr2.slice(0, arr2.length - 1);
		//alert(arr2.length);//0
		arr2[0] = "aaa";
		arr2[1] = "bbb";
		arr2[2] = "ccc";
		arr2 = arr2.slice(0, 1);
		//		alert(arr2.length); //1
		//		alert(arr2[0]); //aaa
		//		alert(arr2[1]); //undefined

		//shift：删除原数组第一项，并返回删除元素的值；如果数组为空则返回undefined 
		var a = [1, 2, 3, 4, 5];
		var b = a.shift(); //a：[2,3,4,5]   b：1 

		//unshift：将参数添加到原数组开头，并返回数组的长度 
		var a = [1, 2, 3, 4, 5];
		var b = a.unshift(-2, -1); //a：[-2,-1,1,2,3,4,5]   b：7 
		//注：在IE6.0下测试返回值总为undefined，FF2.0下测试返回值为7，所以这个方法的返回值不可靠，需要用返回值时可用splice代替本方法来使用。 

		//pop：删除原数组最后一项，并返回删除元素的值；如果数组为空则返回undefined 
		var a = [1, 2, 3, 4, 5];
		var b = a.pop(); //a：[1,2,3,4]   b：5 //不用返回的话直接调用就可以了

		//push：将参数添加到原数组末尾，并返回数组的长度 
		var a = [1, 2, 3, 4, 5];
		var b = a.push(6, 7); //a：[1,2,3,4,5,6,7]   b：7 

		//concat：返回一个新数组，是将参数添加到原数组中构成的 
		var a = [1, 2, 3, 4, 5];
		var b = a.concat(6, 7); //a：[1,2,3,4,5]   b：[1,2,3,4,5,6,7] 

		//splice(start,deleteCount,val1,val2,...)：从start位置开始删除deleteCount项，并从该位置起插入val1,val2,... 
		var a = [1, 2, 3, 4, 5];
		var b = a.splice(2, 2, 7, 8, 9); //a：[1,2,7,8,9,5]   b：[3,4] 
		var b = a.splice(0, 1); //同shift 
		a.splice(0, 0, -2, -1);
		var b = a.length; //同unshift 
		var b = a.splice(a.length - 1, 1); //同pop 
		a.splice(a.length, 0, 6, 7);
		var b = a.length; //同push 

		//reverse：将数组反序 
		var a = [1, 2, 3, 4, 5];
		var b = a.reverse(); //a：[5,4,3,2,1]   b：[5,4,3,2,1] 

		//sort(orderfunction)：按指定的参数对数组进行排序 
		var a = [1, 2, 3, 4, 5];
		var b = a.sort(); //a：[1,2,3,4,5]   b：[1,2,3,4,5] 

		//slice(start,end)：返回从原数组中指定开始下标到结束下标之间的项组成的新数组 
		var a = [1, 2, 3, 4, 5];
		var b = a.slice(2, 5); //a：[1,2,3,4,5]   b：[3,4,5] 

		//join(separator)：将数组的元素组起一个字符串，以separator为分隔符，省略的话则用默认用逗号为分隔符 
		var a = [1, 2, 3, 4, 5];
		var b = a.join("|"); //a：[1,2,3,4,5]   b："1|2|3|4|5"

		//再给个利用数组模拟javaStringBuffer处理字符串的方法：

		/**
		 * 字符串处理函数
		 */
		function StringBuffer() {
			var arr = new Array;
			this.append = function(str) {
				arr[arr.length] = str;
			};

			this.toString = function() {
				return arr.join(""); //把append进来的数组ping成一个字符串
			};
		}

		//今天在应用中突然发现join是一种把数组转换成字符串的好方法，故封装成对象使用了：

		/**
		 * 把数组转换成特定符号分割的字符串
		 */
		function arrayToString(arr, separator) {
			if(!separator) separator = ""; //separator为null则默认为空
			return arr.join(separator);
		}

		/**
		 * 查找数组包含的字符串
		 */
		function arrayFindString(arr, string) {
			var str = arr.join("");
			return str.indexOf(string);
		}

		var barr = ["a", "b", "c"];
		var barr2 = ["a", "c", "f"];
		barr = ["a", "c", "7"];
		barr2 = ["a", "3", "f"];
		var obj = {
			avalueAmount: "0",
			bindId: "10007",
			dPrice: 0,
			descripTion: null,
			discount: 0.33,
			fid: null,
			gCode: "ffgg",
			gName: "ggg",
			goodId: "6330",
			goodsSpec: null,
			goodsThumb: "http://img.mall.ccb.com/img/pic_no.png",
			model: null,
			oPrice: 0
		}
		var obj2 = {
			avalueAmount: "1",
			bindId: "10001",
			dPrice: 0,
			descripTion: null,
			discount: 0.33,
			fid: null,
			gCode: "ffgg",
			gName: "ggg",
			goodId: "6330",
			goodsSpec: null,
			goodsThumb: "http://img.mall.ccb.com/img/pic_no.png",
			model: null,
			oPrice: 0
		}
		var obj3 = {
			avalueAmount: "2",
			bindId: "10002",
			dPrice: 0,
			descripTion: null,
			discount: 0.33,
			fid: null,
			gCode: "ffgg",
			gName: "ggg",
			goodId: "6330",
			goodsSpec: null,
			goodsThumb: "http://img.mall.ccb.com/img/pic_no.png",
			model: null,
			oPrice: 0
		}
		var obj4 = {
			avalueAmount: "3",
			bindId: "10003",
			dPrice: 0,
			descripTion: null,
			discount: 0.33,
			fid: null,
			gCode: "ffgg",
			gName: "ggg",
			goodId: "6330",
			goodsSpec: null,
			goodsThumb: "http://img.mall.ccb.com/img/pic_no.png",
			model: null,
			oPrice: 0
		}
		var obj5 = {
			avalueAmount: "4",
			bindId: "10004",
			dPrice: 0,
			descripTion: null,
			discount: 0.33,
			fid: null,
			gCode: "ffgg",
			gName: "ggg",
			goodId: "6330",
			goodsSpec: null,
			goodsThumb: "http://img.mall.ccb.com/img/pic_no.png",
			model: null,
			oPrice: 0
		}
		var obj6 = {
			avalueAmount: "0",
			bindId: "10007",
			dPrice: 0,
			descripTion: null,
			discount: 0.33,
			fid: null,
			gCode: "ffgg",
			gName: "ggg",
			goodId: "6330",
			goodsSpec: null,
			goodsThumb: "http://img.mall.ccb.com/img/pic_no.png",
			model: null,
			oPrice: 0
		}
		var obj22 = {
			avalueAmount: "10",
			bindId: "10007",
			dPrice: 0,
			descripTion: null,
			discount: 0.33,
			fid: null,
			gCode: "ffgg",
			gName: "ggg",
			goodId: "6330",
			goodsSpec: null,
			goodsThumb: "http://img.mall.ccb.com/img/pic_no.png",
			model: null,
			oPrice: 0
		}
		var obj33 = {
			avalueAmount: "20",
			bindId: "10007",
			dPrice: 0,
			descripTion: null,
			discount: 0.33,
			fid: null,
			gCode: "ffgg",
			gName: "ggg",
			goodId: "6330",
			goodsSpec: null,
			goodsThumb: "http://img.mall.ccb.com/img/pic_no.png",
			model: null,
			oPrice: 0
		}
		var obj44 = {
			avalueAmount: "0",
			bindId: "10007",
			dPrice: 0,
			descripTion: null,
			discount: 0.33,
			fid: null,
			gCode: "ffgg",
			gName: "ggg",
			goodId: "6330",
			goodsSpec: null,
			goodsThumb: "http://img.mall.ccb.com/img/pic_no.png",
			model: null,
			oPrice: 0
		}
		var obj55 = {
			avalueAmount: "0",
			bindId: "10007",
			dPrice: 0,
			descripTion: null,
			discount: 0.33,
			fid: null,
			gCode: "ffgg",
			gName: "ggg",
			goodId: "6330",
			goodsSpec: null,
			goodsThumb: "http://img.mall.ccb.com/img/pic_no.png",
			model: null,
			oPrice: 0
		}
		var oldlist = [obj, obj2, obj3, obj4];
		var newlist = [obj22, obj, obj33, obj44];
		for(var i = 0; i < oldlist.length; i++) {
			for(var j = 0; j < newlist.length; j++) {
				if(oldlist[i] == newlist[j]) {
					//console.log(oldlist[i]);
				}
			}
		}

		function deteleObject(obj) {
			var uniques = [];
			var stringify = {};
			for(var i = 0; i < obj.length; i++) {
				var keys = [];
				//keys = Object.keys(obj[i]);//Object.keys ie8以下不兼容
				
				var ob = {};
				ob = obj[i];
				//var keyarr = [];
				for(var itemkey in ob){
					//console.log(i);
					keys.push(itemkey);
				}
				//console.log(keys);
				//对数组进行升序排列，将函数作为参数传入
				keys.sort(function(a, b) {
					//console.log(Number(a) +'-'+ Number(b));
					return(Number(a) - Number(b)); //数组中两两比较，结果为正(a>b)，则互换位置,小的在前面(从索引0开始，分别和后面元素比较)
				});
				//console.log(keys);
				var str = '';
				for(var j = 0; j < keys.length; j++) {
					str += JSON.stringify(keys[j]);
					//console.log([keys[j]]);
					//str += JSON.stringify(obj[i][keys[j]]);
					str += JSON.stringify(ob[keys[j]]);
					//console.log(obj[i][keys[j]]);
				}
				if(!stringify.hasOwnProperty(str)) {
					//uniques.push(obj[i]);
					uniques.push(ob);
					stringify[str] = true;
				}
			}
			uniques = uniques;
			return uniques;
		}

		var DEFAULT_VERSION = 8.0;
		var ua = navigator.userAgent.toLowerCase();
		var isIE = ua.indexOf("msie") > -1;
		var safariVersion;

		if(isIE) {
			safariVersion = ua.match(/msie ([\d.]+)/)[1];
		}

		if(safariVersion <= DEFAULT_VERSION) {   
			//alert('系统检测到您正在使用ie8以下内核的浏览器，不能实现完美体验，请更换或升级浏览器访问！')
			if(!Object.keys) { 
				Object.keys = (function() {  
					var hasOwnProperty = Object.prototype.hasOwnProperty,
						    hasDontEnumBug = !({
							toString: null
						}).propertyIsEnumerable('toString'),
						    dontEnums = ['toString', 'toLocaleString', 'valueOf', 'hasOwnProperty', 'isPrototypeOf', 'propertyIsEnumerable', 'constructor'],
						    dontEnumsLength = dontEnums.length;

					  
					return function(obj) {   
						if(typeof obj !== 'object' && typeof obj !== 'function' || obj === null) {
							throw new TypeError('Object.keys called on non-object');
						}   
						var result = [];   
						for(var prop in obj) {    
							if(hasOwnProperty.call(obj, prop)) result.push(prop);   
						}   
						if(hasDontEnumBug) {    
							for(var i = 0; i < dontEnumsLength; i++) {     
								if(hasOwnProperty.call(obj, dontEnums[i])) result.push(dontEnums[i]);    
							}   
						}   
						return result;  
					} 
				})()
			};
		};

		var allarr = oldlist.concat(newlist);
		//console.log(allarr[0]["gName"]);
		console.log(deteleObject(allarr))
		Array.prototype.unique4 = function() {
			this.sort();
			var re = [this[0]];
			for(var i = 1; i < this.length; i++) {
				if(this[i] !== re[re.length - 1]) {
					re.push(this[i]);
				}
			}
			return re;
		}
		allarr.unique4();
		//console.log(allarr);
		var list = []
		for(var i = 0; i < allarr.length; i++) {
			list.push(JSON.stringify(allarr[i]));//JSON ie7以下不兼容
		}
		var n = [];
		for(var i = 0; i < oldlist.length; i++) {
			n.push(JSON.stringify(oldlist[i]));
		}
		var m = [];
		for(var i = 0; i < newlist.length; i++) {
			m.push(JSON.stringify(newlist[i]));
		}

		var b = [1, 2, 3, 2, 3, 234, 345];
		b = ['{"avalueAmount":"0","bindId":"10007","dPrice":0,"d….ccb.com/img/pic_no.png","model":null,"oPrice":0}', '{"avalueAmount":"0","bindId":"10007","dPrice":0,"d….ccb.com/img/pic_no.png","model":null,"oPrice":0}', '{"avalueAmount":"0","bindId":"10007","dPrice":0,"d….ccb.com/img/pic_no.png","model":null,"oPrice":0}', '{"avalueAmount":"1","bindId":"10001","dPrice":0,"d….ccb.com/img/pic_no.png","model":null,"oPrice":0}', '{"avalueAmount":"10","bindId":"10007","dPrice":0,"….ccb.com/img/pic_no.png","model":null,"oPrice":0}', '{"avalueAmount":"2","bindId":"10002","dPrice":0,"d….ccb.com/img/pic_no.png","model":null,"oPrice":0}', '{"avalueAmount":"20","bindId":"10007","dPrice":0,"….ccb.com/img/pic_no.png","model":null,"oPrice":0}', '{"avalueAmount":"3","bindId":"10003","dPrice":0,"d….ccb.com/img/pic_no.png","model":null,"oPrice":0}']
		//console.log(b.unique4());
		//console.log(list.sort());
		//		list.unique4();
		//		console.log(list);
		//		list = list.sort();
		////		for(var i = 0 i< list.length;i++){
		////			if(list[i] == list[i])
		////		}
		var newarr = [];
		//for(var i=0;i<barr.length;i++){
		//newarr.push(barr[i]);
		for(var j = 0; j < n.length; j++) {
			//				if(barr.indexOf(barr2[j]) < 0){
			//					newarr.push(barr2[j]);
			//				}
			if($.inArray(m[j], n) < 0) {
				newarr.push(m[j]);
			}
		}
		//}
		console.log(newarr);
		console.log(n.concat(newarr));
		
		const data = [{
			"label": "占用道路问题",
			"value": 31,
			"children": [{
				"label": "经营占道",
				"value": 35,
				"children": [{
					"label": "店外经营占道",
					"value": 40,
					"children": null
				}, {
					"label": "流动摊贩占道",
					"value": 41,
					"children": null
				}]
			}, {
				"label": "垃圾占道",
				"value": 36,
				"children": [{
					"label": "生活垃圾",
					"value": 42,
					"children": null
				}, {
					"label": "建筑垃圾",
					"value": 43,
					"children": null
				}, {
					"label": "工业垃圾",
					"value": 44,
					"children": null
				}]
			}, {
				"label": "车辆占道",
				"value": 37,
				"children": [{
					"label": "机动车占道",
					"value": 45,
					"children": null
				}, {
					"label": "非机动车占道",
					"value": 46,
					"children": null
				}]
			}, {
				"label": "霸占车位",
				"value": 38,
				"children": []
			}, {
				"label": "其他占道",
				"value": 39,
				"children": []
			}]
		}, {
			"label": "“两违”问题",
			"value": 32,
			"children": [{
				"label": "违法建筑",
				"value": 58,
				"children": [{
					"label": "房屋违建",
					"value": 61,
					"children": null
				}, {
					"label": "小区违建",
					"value": 62,
					"children": null
				}, {
					"label": "违建棚架",
					"value": 63,
					"children": null
				}]
			}, {
				"label": "违法用地",
				"value": 59,
				"children": []
			}, {
				"label": "其他违建",
				"value": 60,
				"children": []
			}]
		}, {
			"label": "市容设施管理问题",
			"value": 33,
			"children": [{
				"label": "道路损坏",
				"value": 47,
				"children": []
			}, {
				"label": "垃圾桶损坏",
				"value": 48,
				"children": []
			}, {
				"label": "下水道堵塞",
				"value": 49,
				"children": []
			}, {
				"label": "井盖损坏",
				"value": 50,
				"children": []
			}, {
				"label": "路灯损坏",
				"value": 51,
				"children": []
			}, {
				"label": "树木修剪",
				"value": 52,
				"children": []
			}, {
				"label": "水电气",
				"value": 53,
				"children": []
			}, {
				"label": "户外广告牌",
				"value": 54,
				"children": []
			}, {
				"label": "隔音屏损坏",
				"value": 55,
				"children": []
			}, {
				"label": "洒水车问题",
				"value": 56,
				"children": []
			}, {
				"label": "其他",
				"value": 57,
				"children": []
			}]
		}, {
			"label": "其他问题",
			"value": 34,
			"children": []
		}]
		
		/**
		 * 深度递归搜索
		 * @param {Array} arr 你要搜索的数组
		 * @param {Function} condition 回调函数，必须返回谓词，判断是否找到了。会传入(item, index, level)三个参数
		 * @param {String} children 子数组的key
		 */
		const deepFind = (arr, condition, children) => {
			// 即将返回的数组
			let main = []
		
			// 用try方案方便直接中止所有递归的程序
			try {
				// 开始轮询
				(function poll(arr, level) {
					// 如果传入非数组
					if (!Array.isArray(arr)) return
		
					// 遍历数组
					for (let i = 0; i < arr.length; i++) {
						// 获取当前项
						const item = arr[i]
		
						// 先占位预设值
						main[level] = item
		
						// 检验是否已经找到了
						const isFind = condition && condition(item, i, level) || false
		
						// 如果已经找到了
						if (isFind) {
							// 直接抛出错误中断所有轮询
							throw Error
		
							// 如果存在children，那么深入递归
						} else if (children && item[children] && item[children].length) {
							poll(item[children], level + 1)
		
							// 如果是最后一个且没有找到值，那么通过修改数组长度来删除当前项
						} else if (i === arr.length - 1) {
							// 删除占位预设值
							main.length = main.length - 1
						}
					}
				})(arr, 0)
				// 使用try/catch是为了中止所有轮询中的任务
			} catch (err) {}
		
			// 返回最终数组
			return main
		}
		
		let myarr = deepFind(data, (item, index, level) => item.value === 63, 'children')
		console.log(20181115092957, myarr) // [{…}, {…}, {…}]
		console.log(20181115092957, myarr.map(_ => _.value)) // [32, 58, 63]
		
		
		
		/**
		 * 
		 * 查找数组，返回匹配到的第一个index
		 * 
		 * @param array 被查找的数组
		 * @param feature 查找特征 或者为一个具体值，用于匹配数组遍历的值，或者为一个对象，表明所有希望被匹配的key-value
		 * @param or boolean 希望命中feature全部特征或者只需命中一个特征，默认true
		 * 
		 * @return 数组下标  查找不到返回-1
		 */
		function findArray(array, feature, all = true) {
			for (let index in array) {
				let cur = array[index];
				if (feature instanceof Object) {
					let allRight = true;
					for (let key in feature) {
						let value = feature[key];
						if (cur[key] == value && !all) return index;
						if (all && cur[key] != value) {
							allRight = false;
							break;
						}
					}
					if (allRight) return index;
				} else {
					if (cur == feature) {
						return index;
					}
				}
			}
			return -1;
		}
		
		
		//简单值数组
		var arr = [0, 1, 2, 3, 4, 5];
		var index = findArray(arr, 5);
		
		//对象数组
		var arr = [{
			id: '1',
			name: 'cmx',
			age: 23
		}, {
			id: '2',
			name: '习大大',
			age: 60
		}];
		
		//单个特征查找
		var index = findArray(arr, {
			id: '1'
		});
		
		//多个特征全满足查找
		var index = findArray(arr, {
			id: '1',
			name: 'cmx'
		});
		
		//多个特征单个满足查找（只需满足其中一个）
		var index = findArray(arr, {
			id: '1',
			name: '习大大'
		}, false);
		console.log(index);
	</script>

</html>